<div class="statistics-container" (click)="$event.target !== $event.currentTarget || closeFilterMenu()">
  <div class="statistics-container__header">
    <h2>Estadísticas</h2>
  </div>
  
  <div class="statistics-container__filters">
    <div class="time-range">
      <button 
        [class.active]="timeRange === 'day'" 
        (click)="onTimeRangeChange('day')"
      >
        Hoy
      </button>
      <button 
        [class.active]="timeRange === 'week'" 
        (click)="onTimeRangeChange('week')"
      >
        Esta semana
      </button>
      <button 
        [class.active]="timeRange === 'month'" 
        (click)="onTimeRangeChange('month')"
      >
        Este mes
      </button>
      <button 
        [class.active]="timeRange === 'year'" 
        (click)="onTimeRangeChange('year')"
      >
        Este año
      </button>
    </div>
    
    <div class="filter-dropdown">
      <button (click)="toggleFilterMenu(); $event.stopPropagation()" class="filter-button">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
        </svg>
      </button>
      <div class="filter-menu" *ngIf="showFilterMenu" (click)="$event.stopPropagation()">
        <div class="filter-option">
          <label>Categoría:</label>
          <div class="select-wrapper">
            <select [(ngModel)]="categoryFilter" (change)="applyFilters()" class="category-select">
              <option value="all">Todas las categorías</option>
              <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
            </select>
          </div>
        </div>
        
        <div class="filter-actions">
          <button (click)="resetFilters()" class="reset-button">Restablecer filtros</button>
        </div>
      </div>
    </div>
  </div>
  
  <div class="statistics-container__summary">
    <div class="summary-card">
      <p class="card-title">Ingresos Totales</p>
      <p class="card-value">{{ formatCurrency(totalRevenue) }}</p>
      <div class="card-trend" [class.positive]="revenueComparison.percentChange > 0" [class.negative]="revenueComparison.percentChange < 0">
        <svg *ngIf="revenueComparison.percentChange > 0" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline>
          <polyline points="16 7 22 7 22 13"></polyline>
        </svg>
        <svg *ngIf="revenueComparison.percentChange < 0" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="22 17 13.5 8.5 8.5 13.5 2 7"></polyline>
          <polyline points="16 17 22 17 22 11"></polyline>
        </svg>
        {{ formatPercentage(revenueComparison.percentChange) }} vs periodo anterior
      </div>
    </div>
    
    <div class="summary-card">
      <p class="card-title">Unidades Vendidas</p>
      <p class="card-value">{{ totalUnitsSold }}</p>
      <div class="card-trend" [class.positive]="unitsSoldComparison.percentChange > 0" [class.negative]="unitsSoldComparison.percentChange < 0">
        <svg *ngIf="unitsSoldComparison.percentChange > 0" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline>
          <polyline points="16 7 22 7 22 13"></polyline>
        </svg>
        <svg *ngIf="unitsSoldComparison.percentChange < 0" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="22 17 13.5 8.5 8.5 13.5 2 7"></polyline>
          <polyline points="16 17 22 17 22 11"></polyline>
        </svg>
        {{ formatPercentage(unitsSoldComparison.percentChange) }} vs periodo anterior
      </div>
    </div>
    
    <div class="summary-card">
      <p class="card-title">Clics Totales</p>
      <p class="card-value">{{ totalClicks }}</p>
      <div class="card-trend" [class.positive]="clicksComparison.percentChange > 0" [class.negative]="clicksComparison.percentChange < 0">
        <svg *ngIf="clicksComparison.percentChange > 0" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline>
          <polyline points="16 7 22 7 22 13"></polyline>
        </svg>
        <svg *ngIf="clicksComparison.percentChange < 0" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="22 17 13.5 8.5 8.5 13.5 2 7"></polyline>
          <polyline points="16 17 22 17 22 11"></polyline>
        </svg>
        {{ formatPercentage(clicksComparison.percentChange) }} vs periodo anterior
      </div>
    </div>
    
    <div class="summary-card">
      <p class="card-title">Tasa de Conversión</p>
      <p class="card-value">{{ formatPercentage(averageConversionRate) }}</p>
      <div class="card-trend" [class.positive]="conversionRateComparison.percentChange > 0" [class.negative]="conversionRateComparison.percentChange < 0">
        <svg *ngIf="conversionRateComparison.percentChange > 0" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline>
          <polyline points="16 7 22 7 22 13"></polyline>
        </svg>
        <svg *ngIf="conversionRateComparison.percentChange < 0" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="22 17 13.5 8.5 8.5 13.5 2 7"></polyline>
          <polyline points="16 17 22 17 22 11"></polyline>
        </svg>
        {{ formatPercentage(conversionRateComparison.percentChange) }} vs periodo anterior
      </div>
    </div>
  </div>
  
  <div class="statistics-container__panels">
    <div class="panel">
      <div class="panel-header">
        <h3>Productos Más Vendidos {{ categoryFilter !== 'all' ? '- ' + categoryFilter : '' }}</h3>
      </div>
      <div class="panel-content">
        <table>
          <thead>
            <tr>
              <th>Producto</th>
              <th>Categoría</th>
              <th>Precio</th>
              <th>Unidades</th>
              <th>Ingresos</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let product of filteredProducts.slice(0, 10)">
              <td>{{ product.name }}</td>
              <td>{{ product.category }}</td>
              <td>{{ formatCurrency(product.price) }}</td>
              <td>{{ product.unitsSold }}</td>
              <td>{{ formatCurrency(product.revenue) }}</td>
            </tr>
            <tr *ngIf="filteredProducts.length === 0">
              <td colspan="5" style="text-align: center;">No hay datos disponibles</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

